{% extends "base.html" %}
{% block title %}Compare Resumes - RankRite{% endblock %}
{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-primary mb-3">
            <i class="bi bi-file-earmark-diff me-3"></i>Compare Resumes
        </h1>
        <p class="lead text-muted">
            Compare two resumes side-by-side against a job description to find the best candidate.
        </p>
    </div>
    
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-upload me-2"></i>Upload Documents for Comparison
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="border rounded p-3 h-100">
                                    <h6 class="fw-bold text-primary mb-3">
                                        <i class="bi bi-file-earmark-person me-2"></i>Resume 1
                                    </h6>
                                    <div class="mb-3">
                                        <label for="resumeA" class="form-label">Upload Resume</label>
                                        <input type="file" class="form-control" id="resumeA" name="resumeA" 
                                               accept=".pdf,.docx" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="candidateA" class="form-label">Candidate Name (Optional)</label>
                                        <input type="text" class="form-control" id="candidateA" name="candidateA" 
                                               placeholder="e.g., John Doe">
                                    </div>
                                    <div class="form-text">
                                        <small>PDF or DOCX format, max 10MB</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="border rounded p-3 h-100">
                                    <h6 class="fw-bold text-success mb-3">
                                        <i class="bi bi-file-earmark-person me-2"></i>Resume 2
                                    </h6>
                                    <div class="mb-3">
                                        <label for="resumeB" class="form-label">Upload Resume</label>
                                        <input type="file" class="form-control" id="resumeB" name="resumeB" 
                                               accept=".pdf,.docx" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="candidateB" class="form-label">Candidate Name (Optional)</label>
                                        <input type="text" class="form-control" id="candidateB" name="candidateB" 
                                               placeholder="e.g., Jane Smith">
                                    </div>
                                    <div class="form-text">
                                        <small>PDF or DOCX format, max 10MB</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="job_description" class="form-label">Job Description</label>
                                    <textarea class="form-control" id="job_description" name="job_description" 
                                              rows="6" placeholder="Paste job description here..." required></textarea>
                                </div>
                                <button type="button" class="btn btn-outline-info btn-sm" 
                                        data-bs-toggle="modal" data-bs-target="#sampleJDModal">
                                    <i class="bi bi-eye me-1"></i>View Sample Job Description
                                </button>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                                    <button type="submit" class="btn btn-primary btn-lg px-5">
                                        <i class="bi bi-cpu me-2"></i>Compare Resumes
                                    </button>
                                    <button type="reset" class="btn btn-outline-secondary btn-lg">
                                        <i class="bi bi-arrow-clockwise me-2"></i>Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    {% if results %}
    <!-- Results Section -->
    <div class="mt-5">
        <div class="text-center mb-4">
            <h2 class="fw-bold text-primary">
                <i class="bi bi-trophy me-2"></i>Comparison Results
            </h2>
            <p class="text-muted">Detailed analysis of both resumes</p>
        </div>
        
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-file-earmark-person me-2"></i>Resume 1
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="position-relative d-inline-block">
                                <svg width="120" height="120" class="circular-progress">
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#e9ecef" stroke-width="6"/>
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#0d6efd" stroke-width="6" 
                                            stroke-dasharray="314" stroke-dashoffset="314" 
                                            stroke-linecap="round" id="progress-circleA"/>
                                </svg>
                                <div class="position-absolute top-50 start-50 translate-middle text-center">
                                    <h3 class="fw-bold text-primary mb-0">{{ results.score1 }}/10</h3>
                                    <small class="text-muted">Score</small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <h6 class="fw-bold">Matched Keywords</h6>
                            <p class="text-muted">{{ results.keywords1 }}</p>
                        </div>
                        <div class="mb-3">
                            <h6 class="fw-bold">Document Length</h6>
                            <p class="text-muted">{{ results.length1 }} words</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-file-earmark-person me-2"></i>Resume 2
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="position-relative d-inline-block">
                                <svg width="120" height="120" class="circular-progress">
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#e9ecef" stroke-width="6"/>
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#198754" stroke-width="6" 
                                            stroke-dasharray="314" stroke-dashoffset="314" 
                                            stroke-linecap="round" id="progress-circleB"/>
                                </svg>
                                <div class="position-absolute top-50 start-50 translate-middle text-center">
                                    <h3 class="fw-bold text-success mb-0">{{ results.score2 }}/10</h3>
                                    <small class="text-muted">Score</small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <h6 class="fw-bold">Matched Keywords</h6>
                            <p class="text-muted">{{ results.keywords2 }}</p>
                        </div>
                        <div class="mb-3">
                            <h6 class="fw-bold">Document Length</h6>
                            <p class="text-muted">{{ results.length2 }} words</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card border-0 shadow-sm mt-4">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-award me-2"></i>Final Verdict
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="fw-bold">Better Match</h6>
                        <p class="text-primary fs-5">{{ results.better }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="fw-bold">Suggestions</h6>
                        <p class="text-muted">{{ results.suggestion }}</p>
                    </div>
                </div>
                
                <hr>
                
                <h6 class="fw-bold text-warning">💡 Tips to Improve Resumes:</h6>
                <ul>
                    <li>Use action-oriented keywords from the job description.</li>
                    <li>Quantify your achievements (e.g., "Increased efficiency by 25%").</li>
                    <li>Customize your summary to match the job profile.</li>
                    <li>Ensure clarity, structure, and avoid filler content.</li>
                </ul>
                
                <div class="text-center mt-4">
                    <a href="{{ url_for('compare_resumes') }}" class="btn btn-primary">
                        <i class="bi bi-arrow-left me-2"></i>Compare More Resumes
                    </a>
                    <button class="btn btn-outline-secondary" onclick="window.print()">
                        <i class="bi bi-printer me-2"></i>Print Results
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Sample Job Description Modal -->
<div class="modal fade" id="sampleJDModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sample Job Description</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <textarea class="form-control" rows="15" readonly id="sampleJDTextarea">Senior Software Engineer - Python/React
We are looking for a Senior Software Engineer to join our growing engineering team. You will be responsible for designing and developing scalable web applications and APIs.
Key Responsibilities:
• Design and develop high-quality software solutions using Python and React
• Build and maintain RESTful APIs and microservices
• Work with PostgreSQL and Redis for data storage and caching
• Collaborate with product managers and designers in an Agile environment
• Mentor junior developers and conduct code reviews
• Participate in architectural decisions and technical planning
Required Skills & Experience:
• 5+ years of software engineering experience
• Strong proficiency in Python (Django/Flask) and JavaScript (React/Node.js)
• Experience with SQL databases, preferably PostgreSQL
• Knowledge of cloud platforms (AWS/GCP) and containerization (Docker)
• Understanding of software engineering best practices and design patterns
• Experience with version control (Git) and CI/CD pipelines
• Strong problem-solving skills and attention to detail
Preferred Qualifications:
• Bachelor's or Master's degree in Computer Science or related field
• Experience with data science libraries (pandas, numpy, sklearn)
• Knowledge of message queues (Redis, RabbitMQ)
• Experience with monitoring and logging tools
• Familiarity with agile development methodologies
• Previous experience in a startup or fast-paced environment
What We Offer:
• Competitive salary ($120k - $180k) based on experience
• Equity package and performance bonuses
• Comprehensive health, dental, and vision insurance
• Flexible work arrangements and remote work options
• Professional development budget and learning opportunities
• Modern tech stack and cutting-edge projects
                </textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="useSampleJDForComparison()">Use This Sample</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
function useSampleJDForComparison() {
    const sampleText = document.getElementById('sampleJDTextarea').value; 
    document.getElementById('job_description').value = sampleText;
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('sampleJDModal'));
    modal.hide();
}

// Set circular progress based on scores - only if results exist
document.addEventListener('DOMContentLoaded', function() {
    {% if results %}
    const score1 = {{ results.score1|default(0) }};
    const score2 = {{ results.score2|default(0) }};
    
    if (score1 > 0) {
        const circleA = document.getElementById('progress-circleA');
        const circumference = 2 * Math.PI * 50; 
        const offset = circumference - (score1 / 10) * circumference;
        circleA.style.strokeDashoffset = offset;
    }
    
    if (score2 > 0) {
        const circleB = document.getElementById('progress-circleB');
        const circumference = 2 * Math.PI * 50; 
        const offset = circumference - (score2 / 10) * circumference;
        circleB.style.strokeDashoffset = offset;
    }
    {% endif %}
});
</script>

<style>
.circular-progress {
    transform: rotate(-90deg);
}
</style>
{% endblock %}